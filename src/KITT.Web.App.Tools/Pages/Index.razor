@page "/tools"
@inject IStringLocalizer<UI.Resources.Common> CommonLocalizer

@attribute [Authorize]

<PageTitle>KITT - Live Tools</PageTitle>

<PageLayout PageTitle="Tools">
    <Toolbar>
        <NavButton Label="@CommonLocalizer[nameof(UI.Resources.Common.Back)]"
                   Page="/" />
    </Toolbar>
    <PageContent>
        <MudPaper class="pa-2">
            @if (isLoadingStreamings)
            {
                <MudProgressCircular Color="Color.Primary" Indeterminate="true" />
            }
            else
            {
                <EditForm id="saveStreamingStats" Model="model" OnValidSubmit="SaveStreamingStatsAsync">
                    <MudGrid>
                        <MudItem xs="12" md="10">
                            <MudSelect T="ScheduledStreamingModel"
                                       Variant="Variant.Outlined"
                                       Label="@Localizer[nameof(Resources.Pages.Index.ScheduledStreamingsLabel)]"
                                       @bind-Value="model.CurrentStreaming"
                                       For="@(() => model.CurrentStreaming)"
                                       Margin="Margin.Dense"
                                       id="currentStreaming">
                                @foreach (var item in scheduledStreamings)
                                {
                                    <MudSelectItem Value="item" />
                                }
                            </MudSelect>
                        </MudItem>
                        <MudItem xs="12" md="2" class="d-flex align-center">
                            <MudButton ButtonType="ButtonType.Submit" OnClick="SaveStreamingStatsAsync" Disabled="@(model.CurrentStreaming is null || isSavingStats)" Size="Size.Large" Color="Color.Primary" Variant="Variant.Outlined">
                                @if (isSavingStats)
                                {
                                    <MudProgressCircular Class="mr-2" Color="Color.Primary" Indeterminate="true" Size="Size.Small" />
                                }
                                <MudText>@Localizer[nameof(Resources.Pages.Index.SaveStatsButtonText)]</MudText>
                            </MudButton>
                        </MudItem>
                    </MudGrid>
                </EditForm>
            }
        </MudPaper>

        <MudPaper class="mt-5">
            <MudExpansionPanels>
                <MudExpansionPanel Text="@Localizer[nameof(Resources.Pages.Index.BotManagementPanelTitle)]">
                    <MudGrid>
                        <MudItem xs="12" md="2">
                            @if (isBotRunning)
                            {
                                <MudButton Size="Size.Large" Disabled="@discoveringBotStatus" OnClick="StopBotAsync" ButtonType="ButtonType.Button" Color="Color.Primary" Variant="Variant.Filled">
                                    @if (discoveringBotStatus)
                                    {
                                        <MudProgressCircular Class="mr-2" Color="Color.Primary" Indeterminate="true" Size="Size.Small" />
                                    }
                                    <MudText>@Localizer[nameof(Resources.Pages.Index.StopBotLabel)]</MudText>
                                </MudButton>
                            }
                            else
                            {
                                <MudButton Size="Size.Large" Disabled="@discoveringBotStatus" OnClick="StartBotAsync" ButtonType="ButtonType.Button" Color="Color.Primary" Variant="Variant.Outlined">
                                    @if (discoveringBotStatus)
                                    {
                                        <MudProgressCircular Class="mr-2" Color="Color.Primary" Indeterminate="true" Size="Size.Small" />
                                    }
                                    <MudText>@Localizer[nameof(Resources.Pages.Index.StartBotLabel)]</MudText>
                                </MudButton>
                            }
                        </MudItem>
                        <MudItem xs="12" md="10">
                            <MudAlert Severity="messageSeverity" NoIcon="true">@message</MudAlert>
                        </MudItem>
                    </MudGrid>
                </MudExpansionPanel>
                <MudExpansionPanel Text="@Localizer[nameof(Resources.Pages.Index.StatsPanelTitle)]">
                    <MudGrid>
                        <MudItem xs="12" md="6">
                            <MudCard>
                                <MudCardContent>
                                    <MudText Typo="Typo.h4">
                                        @Localizer[nameof(Resources.Pages.Index.ViewersCountText), viewers.Count]
                                    </MudText>
                                </MudCardContent>
                            </MudCard>
                        </MudItem>
                        <MudItem xs="12" md="6">
                            <MudCard>
                                <MudCardContent>
                                    <MudText Typo="Typo.h4">
                                        @Localizer[nameof(Resources.Pages.Index.SubscribersCountText), subscribers.Count]
                                    </MudText>
                                </MudCardContent>
                            </MudCard>
                        </MudItem>
                        <MudItem xs="12" md="6">
                            <MudCard>
                                <MudCardContent>
                                    <MudText Typo="Typo.h4">
                                        @Localizer[nameof(Resources.Pages.Index.UsersJoinedCountText), userJoinedNumber]
                                    </MudText>
                                </MudCardContent>
                            </MudCard>
                        </MudItem>
                        <MudItem xs="12" md="6">
                            <MudCard>
                                <MudCardContent>
                                    <MudText Typo="Typo.h4">
                                        @Localizer[nameof(Resources.Pages.Index.UsersLeftCountText), userLeftNumber]
                                    </MudText>
                                </MudCardContent>
                            </MudCard>
                        </MudItem>
                    </MudGrid>
                </MudExpansionPanel>
            </MudExpansionPanels>
        </MudPaper>
    </PageContent>
</PageLayout>
